package service;

import blibliotheque.Data;
import blibliotheque.ServiceServer;

import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;

public class RetourServer implements ServiceServer {
	private static final int PORT = 2700;
	private static final String IP = "127.0.0.1";
	private static final String RETOUR_ACTION = "Retour";
	private ServerSocket server;
	
	public RetourServer(){
		
	}
	
	@Override
	public void run() {
		// TODO Auto-generated method stub
		if(server != null){// if there was no IOEception, we can start to work
			try {
				System.out.println("Le server est en marche");
				do{
					Socket s = server.accept(); // accept connections
					s.setSoTimeout(1);
					Data d = new Data(s,null, this);
					input.add(d); // put data on the inputworker
					d.setMsg(AUTHENTIFICATION_ACTION + System.getProperty("line.separator") + "Vous êtes connecté(e) sur le serveur"
					+ System.getProperty("line.separator") + " Entrez votre Id pour vous identifier" + System.getProperty("line.separator"));
					output.add(d); // start the communication
					synchronized(map){
						map.put(s, null); // put on the map
						System.out.println("Un nouveau client est accepté, il y en a "+ map.size());
					}
				}while(true);
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		
	}

	@Override
	public boolean consume(Data data) {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public void remove(Socket s) {
		// TODO Auto-generated method stub
		
	}
}
